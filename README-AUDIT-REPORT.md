# –°–¢–ê–¢–ò–ß–ï–°–ö–ò–ô –ê–£–î–ò–¢ –ö–û–ù–°–¢–†–£–ö–¢–û–†–ê –í–ò–ö–ò

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞  
**–î–∞—Ç–∞:** 28 –∞–≤–≥—É—Å—Ç–∞ 2025  

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–¢—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### 1. **–û–¢–°–£–¢–°–¢–í–ò–ï –ö–ù–û–ü–ö–ò –£–î–ê–õ–ï–ù–ò–Ø –ë–õ–û–ö–û–í**
- **–§–∞–π–ª:** `frontend/src/widgets/ContextualInspector/index.tsx`
- **–í–ª–∏—è–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å –±–ª–æ–∫–∏
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è –≤ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä

### 2. **–†–ï–í–ò–ó–ò–ò –ù–ï –°–û–•–†–ê–ù–Ø–Æ–¢ –°–¢–†–£–ö–¢–£–†–£ –í–õ–û–ñ–ï–ù–ù–û–°–¢–ò**
- **–§–∞–π–ª:** `backend/src/routes/layoutRoutes.ts:249`
- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** `parent_block_id`, `slot`
- **–í–ª–∏—è–Ω–∏–µ:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ—Ä–µ–≤–æ –±–ª–æ–∫–æ–≤
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ SELECT –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–≤–∏–∑–∏–∏

### 3. **–û–¢–°–£–¢–°–¢–í–ò–ï –°–ï–õ–ï–ö–¢–û–†–ê –°–¢–†–ê–ù–ò–¶**
- **–§–∞–π–ª:** `frontend/src/widgets/EditorToolbar/index.tsx`
- **–í–ª–∏—è–Ω–∏–µ:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ-–ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å dropdown –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 4. **–ù–ï–¢ –ö–ê–°–ö–ê–î–ù–û–ì–û –£–î–ê–õ–ï–ù–ò–Ø**
- **–§–∞–π–ª:** `backend/src/routes/layoutRoutes.ts:158`
- **–í–ª–∏—è–Ω–∏–µ:** –û—Ä—Ñ–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

### 5. **–û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò allowedChildren**
- **–§–∞–π–ª:** `backend/src/routes/layoutRoutes.ts:55`
- **–í–ª–∏—è–Ω–∏–µ:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –±–ª–æ–∫–æ–≤
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ API

### 6. **–û–¢–°–£–¢–°–¢–í–ò–ï –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–ò –ì–õ–£–ë–ò–ù–´**
- **–§–∞–π–ª:** `frontend/src/widgets/BlockRenderer/ui/BlockRenderer.tsx`
- **–í–ª–∏—è–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–Ω–∏–º–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å—Ç—É–ø—ã –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –ê–†–¢–ï–§–ê–ö–¢–´

### –û—Ç—á–µ—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```
docs/
‚îú‚îÄ‚îÄ audit-summary.md          # –°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç —Å –≤—ã–≤–æ–¥–∞–º–∏
‚îú‚îÄ‚îÄ db-model.md              # –ê–Ω–∞–ª–∏–∑ —Å—Ö–µ–º—ã –ë–î
‚îú‚îÄ‚îÄ api-surface.md           # –ê–Ω–∞–ª–∏–∑ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ components-audit.md      # –ê–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–ª–æ–∫–æ–≤
‚îú‚îÄ‚îÄ editor-audit.md          # UX —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
‚îú‚îÄ‚îÄ revisions-audit.md       # –°–∏—Å—Ç–µ–º–∞ —Ä–µ–≤–∏–∑–∏–π
‚îú‚îÄ‚îÄ graphs/
‚îÇ   ‚îú‚îÄ‚îÄ data-flow.dot        # –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ models.dot           # ER-–¥–∏–∞–≥—Ä–∞–º–º–∞ –º–æ–¥–µ–ª–µ–π
```

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
```
artifacts/
‚îú‚îÄ‚îÄ model-map.json           # –ü–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –ë–î
‚îú‚îÄ‚îÄ api.csv                  # –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ blocks.json              # –†–µ–µ—Å—Ç—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–ª–æ–∫–æ–≤
‚îî‚îÄ‚îÄ crossref.csv             # –ü–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —Å–∏–º–≤–æ–ª–æ–≤
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–≥–æ—Ç–æ–≤–∫–∏
```
tests/
‚îú‚îÄ‚îÄ revision.snapshot.test.ts     # –¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ä–µ–≤–∏–∑–∏–π
‚îú‚îÄ‚îÄ delete.cascade.mock.test.ts   # –¢–µ—Å—Ç—ã –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ hierarchy.validation.test.ts  # –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–µ—Ä–∞—Ä—Ö–∏–∏
```

### –§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```
fixtures/
‚îú‚îÄ‚îÄ page.tree.sample.json         # –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îî‚îÄ‚îÄ revision.sample.json          # –ü—Ä–∏–º–µ—Ä —Ä–µ–≤–∏–∑–∏–∏
```

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### üî• –ö–†–ò–¢–ò–ß–ù–´–ô (1-2 –¥–Ω—è)
1. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è –≤ ContextualInspector
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ parent_block_id/slot –≤ —Ä–µ–≤–∏–∑–∏—è—Ö
3. –î–æ–±–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü –≤ EditorToolbar

### ‚ö° –í–´–°–û–ö–ò–ô (3-5 –¥–Ω–µ–π)
4. –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≥–ª—É–±–∏–Ω—ã –≤ BlockRenderer
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤ API
6. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é allowedChildren –≤ API

### üìà –°–†–ï–î–ù–ò–ô (1-2 –Ω–µ–¥–µ–ª–∏)
7. –£–ª—É—á—à–∏—Ç—å UX —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ (drag handles, breadcrumbs)
8. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è
9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å undo/redo –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è:
```typescript
// –í ContextualInspector/index.tsx
interface ContextualInspectorProps {
  onBlockDelete?: (blockId: string) => Promise<void>
}

// –î–æ–±–∞–≤–∏—Ç—å –≤ JSX:
{onBlockDelete && (
  <Button onClick={() => onBlockDelete(block.id)}>
    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫
  </Button>
)}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–≤–∏–∑–∏–π:
```typescript
// –í layoutRoutes.ts:249
const { data: blocks } = await supabaseAdmin
  .from('layout_blocks')
  .select('id, block_type, content, position, status, parent_block_id, slot')
  // ‚úÖ –î–û–ë–ê–í–ò–¢–¨: id, parent_block_id, slot
```

### –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:
```typescript
// –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è
async function deleteBlockWithChildren(blockId: string) {
  const descendants = await findAllDescendants(blockId)
  await supabaseAdmin.from('layout_blocks').delete().in('id', descendants)
}
```

## üìä –ú–ï–¢–†–ò–ö–ò –ü–†–û–ï–ö–¢–ê

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –°—Ç–∞—Ç—É—Å |
|-----------|------------|--------|
| –í—Å–µ–≥–æ –±–ª–æ–∫–æ–≤ | 13 | ‚úÖ |
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã—Ö –±–ª–æ–∫–æ–≤ | 1 | ‚úÖ |
| –ê—Ç–æ–º–∞—Ä–Ω—ã—Ö –±–ª–æ–∫–æ–≤ | 12 | ‚úÖ |
| API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ | 19 | ‚úÖ |
| –¢–∞–±–ª–∏—Ü –ë–î | 6 | ‚úÖ |
| –û—Ç–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º | 6 | üö® |

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–ù–∞—á–∞—Ç—å —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º** - –æ–Ω–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
2. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏
3. **–í–Ω–µ–¥—Ä–∏—Ç—å code review** –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ –±–ª–æ–∫–æ–≤
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** –≤—Å–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üîç –ú–ï–¢–û–î–û–õ–û–ì–ò–Ø –ê–£–î–ò–¢–ê

- ‚úÖ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î –∏–∑ SQL –∏ TypeScript
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ê—É–¥–∏—Ç UX —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–≤–∏–∑–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∏–∫—Å—Ç—É—Ä
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º –∏ –æ—Ç—á–µ—Ç–æ–≤

---

*–ê—É–¥–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º –∞–Ω–∞–ª–∏–∑–æ–º –∫–æ–¥–∞ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è*
