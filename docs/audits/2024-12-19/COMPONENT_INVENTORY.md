# Инвентаризация компонентов

## Общая статистика

- **Всего TSX файлов**: 141
- **React компонентов**: ~120+ (включая хуки и утилиты)
- **Блоков системы**: 9 атомарных + 2 layout
- **Модулей дизайн-системы**: 60+ (atoms/molecules/organisms)

## Архитектурное распределение компонентов

### FSD слой: widgets/ (крупные UI блоки)
**Количество файлов**: 72

#### Ключевые компоненты:

| Компонент | Строк кода | Сложность | Описание |
|-----------|------------|-----------|----------|
| `EditorToolbar/index.tsx` | 306 | Высокая | Основная панель инструментов редактора с множеством функций |
| `ContextualInspector/index.tsx` | 280+ | Высокая | Панель свойств блоков с множеством контроллов |
| `BlockRenderer/index.tsx` | 200+ | Средняя | Рендерер блоков с поддержкой вложенности |
| `UnifiedSidebar/index.tsx` | 180+ | Средняя | Единая боковая панель с вкладками |
| `VirtualizedCanvas/index.tsx` | 160+ | Средняя | Виртуализированный холст для больших страниц |

#### Распределение по типам:
- **Редакторы**: 15 компонентов (EditorToolbar, BlockEditors/*)
- **Панели управления**: 8 компонентов (Inspector, Sidebar, Toolbar)
- **Библиотеки**: 6 компонентов (BlockLibrary, ReusableBlocksLibrary)
- **Модальные окна**: 5 компонентов (RevisionsModal, OverridesPanel)
- **Навигация**: 4 компонента (Breadcrumbs, Header)
- **Отображение блоков**: 20+ компонентов (AtomicBlocks/*, LayoutBlocks/*)

### FSD слой: features/ (бизнес-логика)
**Количество файлов**: 32

#### Ключевые компоненты:

| Компонент | Строк кода | Сложность | Описание |
|-----------|------------|-----------|----------|
| `PageEditor/ui/PageEditor.tsx` | 200+ | Высокая | Основной редактор страниц |
| `ReusableBlocksLibrary/index.tsx` | 180+ | Высокая | Библиотека переиспользуемых блоков |
| `BlockEditors/ButtonEditor/index.tsx` | 120+ | Средняя | Редактор свойств кнопки |
| `BlockEditors/HeadingEditor/index.tsx` | 100+ | Средняя | Редактор свойств заголовка |

#### Распределение по типам:
- **Редакторы блоков**: 10 компонентов (BlockEditors/*)
- **Модальные окна**: 6 компонентов (Edit/Create модалы)
- **Библиотеки**: 3 компонента (ReusableBlocksLibrary, TemplatesManager)
- **Инструменты**: 3 компонента (DebugTools, DnDTools)

### FSD слой: entities/ (бизнес-сущности)
**Количество файлов**: 12

#### Компоненты:

| Компонент | Строк кода | Сложность | Описание |
|-----------|------------|-----------|----------|
| `category/ui/CategoryCard.tsx` | 50+ | Низкая | Карточка категории |
| `property/ui/PropertyCard.tsx` | 45+ | Низкая | Карточка свойства |
| `server/ui/ServerStatus.tsx` | 60+ | Средняя | Статус сервера |

### FSD слой: pages/ (страницы приложения)
**Количество файлов**: 18

#### Ключевые страницы:

| Страница | Строк кода | Тип | Описание |
|----------|------------|-----|----------|
| `AdminEditorPage/index.tsx` | 80+ | Основная | Страница визуального редактора |
| `AdminLayout/index.tsx` | 120+ | Layout | Layout админ-панели |
| `HomePage/index.tsx` | 60+ | Публичная | Домашняя страница |
| `LoginPage/index.tsx` | 70+ | Аутентификация | Страница входа |

#### Распределение:
- **Админ страницы**: 8 страниц (/admin/*)
- **Публичные страницы**: 4 страницы
- **Служебные страницы**: 6 страниц (Debug, Demo, Test)

### FSD слой: shared/ (переиспользуемый код)
**Количество файлов**: 25

#### Ключевые компоненты:

| Компонент | Строк кода | Сложность | Описание |
|-----------|------------|-----------|----------|
| `components/ProtectedRoute.tsx` | 80+ | Средняя | Защищенный роут с проверкой аутентификации |
| `contexts/AuthContext.tsx` | 100+ | Средняя | Контекст аутентификации |
| `contexts/NotificationContext.tsx` | 120+ | Средняя | Контекст уведомлений |
| `components/NotificationContainer.tsx` | 60+ | Низкая | Контейнер уведомлений |

## Система блоков

### Атомарные блоки (blocks/atomic/)
**Количество**: 9 блоков

| Блок | Компонент | Строк кода | Функциональность |
|------|-----------|------------|------------------|
| ButtonBlock | `ButtonBlock.tsx` | 88 | Кнопка с ссылкой |
| HeadingBlock | `HeadingBlock.tsx` | 65 | Заголовок с уровнями |
| ParagraphBlock | `ParagraphBlock.tsx` | 55 | Параграф текста |
| ImageBlock | `ImageBlock.tsx` | 80 | Изображение с alt |
| IconBlock | `IconBlock.tsx` | 70 | Иконка из Lucide |
| SpacerBlock | `SpacerBlock.tsx` | 45 | Разделитель |
| SectionBlock | `SectionBlock.tsx` | 90 | Секция с background |

### Layout блоки (blocks/layout/)
**Количество**: 2 блока

| Блок | Компонент | Строк кода | Функциональность |
|------|-----------|------------|------------------|
| ContainerBlock | `ContainerBlock.tsx` | 120 | Контейнер с layout |
| ColumnsBlock | `ColumnsBlock.tsx` | 150 | Многоколоночный layout |

## Дизайн-система (@my-forum/ui)

### Atoms (6 компонентов)
- Button, Input, Select, Checkbox, Radio, Typography

### Molecules (15 компонентов)
- Modal, Dropdown, Tabs, Accordion, Card, Tooltip
- EnhancedColorPicker, SpacingControl, BorderControl
- InspectorField, InspectorSection

### Organisms (3 компонента)
- DataTable, EmptyState, Form

## Кастомные хуки

### Shared hooks (shared/hooks/)
- `useFavorites.ts` - управление избранным

### Widgets hooks (widgets/*/model/)
- `useInspectorLogic.ts` - логика инспектора
- `useButtonBlockLogic.ts` - логика кнопки
- `useButtonBlockStyles.ts` - стили кнопки

### Features hooks (features/*/model/)
- `useLibraryLogic.ts` - логика библиотеки блоков
- `useTemplates.ts` - управление шаблонами

## Утилиты и хелперы

### shared/lib/
- `utils.ts` - общие утилиты
- `types.ts` - типы guards

### shared/mappers/
- `db-ui.ts` - маппинг БД ↔ UI

## Анализ сложности компонентов

### Компоненты высокой сложности (>200 строк):
1. `EditorToolbar/index.tsx` - 306 строк
2. `ContextualInspector/index.tsx` - 280+ строк
3. `BlockRenderer/index.tsx` - 200+ строк

### Компоненты средней сложности (100-200 строк):
1. `UnifiedSidebar/index.tsx` - 180+ строк
2. `PageEditor/ui/PageEditor.tsx` - 200+ строк
3. `ReusableBlocksLibrary/index.tsx` - 180+ строк
4. `VirtualizedCanvas/index.tsx` - 160+ строк

### Компоненты низкой сложности (<100 строк):
- Большинство атомарных блоков (45-90 строк)
- Entity компоненты (45-60 строк)
- Shared компоненты (60-80 строк)

## Анти-паттерны в компонентах

### Обнаруженные проблемы:

1. **Гигантские компоненты**:
   - `EditorToolbar` (306 строк) - слишком много ответственности
   - `ContextualInspector` (280+ строк) - монолитная структура

2. **Смешение логики и представления**:
   - Многие компоненты содержат бизнес-логику в UI слое
   - Недостаточное разделение на model/view

3. **Дублирование кода**:
   - Повторяющиеся паттерны DnD в разных компонентах
   - Дублирование стилей и конфигураций

4. **Отсутствие абстракций**:
   - Прямые импорты из features в widgets
   - Нарушение FSD границ

## Рекомендации по рефакторингу

### Крупные компоненты:
1. **EditorToolbar** → разделить на:
   - `ToolbarActions` (сохранение/отмена)
   - `ToolbarLibraries` (библиотеки блоков)
   - `ToolbarNavigation` (навигация страниц)
   - `ToolbarHistory` (undo/redo)

2. **ContextualInspector** → разделить на:
   - `InspectorTabs` (вкладки)
   - `InspectorControls` (контролы)
   - `InspectorActions` (действия)

### Система блоков:
1. Создать базовый `BlockWrapper` для всех блоков
2. Вынести общую логику DnD в хук `useDraggableBlock`
3. Создать фабрику рендереров блоков

### Архитектурные улучшения:
1. Усилить границы FSD слоев
2. Создать shared hooks для переиспользуемой логики
3. Внедрить паттерн Container/Presentational где возможно

## Заключение

Компонентная архитектура следует принципам FSD и имеет хорошую модульность. Основные проблемы:

- **Положительные аспекты**:
  - Четкая FSD структура
  - Переиспользуемая дизайн-система
  - Типизированные компоненты
  - Разделение атомарных и layout блоков

- **Области для улучшения**:
  - Рефакторинг гигантских компонентов
  - Устранение дублирования кода
  - Усиление архитектурных границ
  - Создание абстракций для повторяющихся паттернов

Общий объем кода: ~15,000+ строк TypeScript/React с хорошим покрытием основных функций CMS.
